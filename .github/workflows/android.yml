name: ðŸ“¦ðŸš€ Build & deploy Android app
# based on https://github.com/orevial/flutter-ci-cd-demo/blob/main/.github/workflows/_deploy-android-app.yml no license provided
on:
  push:
    branches: '*'
  pull_request:
      branches: '*'

  workflow_dispatch:
jobs:
  deployAndroid:
    name: ðŸ¤–ðŸ“¦ðŸš€ Build & deploy Android
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v2
      - name: âš™ï¸ Setup Java
        uses: actions/setup-java@v1
        with:
          java-version: "12.x"
      - name: âš™ï¸ Setup Flutter
        uses: subosito/flutter-action@v1
        with:
          channel: 'stable'
      - name: ðŸ” Retrieve base64 keystore and decode it to a file
        env:
          KEYSTORE_BASE64: ${{ secrets.KEYSTORE_FILE_BASE64 }}
        run: echo $KEYSTORE_BASE64 | base64 --decode > "android/android-keystore.jks"
      - name: ðŸ“ðŸ” Create keystore.properties file
        env:
          KEYSTORE_PROPERTIES_PATH: android/keystore.properties
        run: |
          echo 'StoreFile=./android-keystore.jks' > $KEYSTORE_PROPERTIES_PATH
          echo 'KeyAlias=${{ secrets.KEYSTORE_KEY_ALIAS }}' >> $KEYSTORE_PROPERTIES_PATH
          echo 'StorePassword=${{ secrets.STORE_PASSWORD }}' >> $KEYSTORE_PROPERTIES_PATH
          echo 'KeyPassword=${{ secrets.KEY_PASSWORD }}' >> $KEYSTORE_PROPERTIES_PATH
      - name: ðŸ¤–ðŸ“¦ Create Android appbundle release
        run: |
          mkdir debug-symbols
          flutter pub get
          flutter build appbundle \
            --release --debug
      - name: ðŸ“¤ Upload Artifacts
        uses: actions/upload-artifact@v2
        with:
          name: android-release-artifact
          path: build/app/outputs/bundle/release/app-release.aab
      - name: ðŸ’¬ Pick a random success catchphrase
        if: success()
        id: success_catchphrase
        run: |
          sentences=('ðŸ¤© AMAZING !' 'Woop woop ðŸŽ‰' 'Oh wow ðŸ˜®' 'ðŸ˜Ž Yeahhhh !' 'ðŸ“£ Amazing announcement !' 'ðŸ“¢ Your attention please...' 'ðŸ‘ Great work !' 'ðŸ¾ Champagne !' 'ðŸ™Œ High five !' 'ðŸ¥³ Time to celebrate !')
          arrayLength=${#sentences[@]}
          randomNumber=$(($RANDOM%$arrayLength))
          pickedSentence=${sentences[$randomNumber]}
          echo "picked_sentence=$pickedSentence" >> $GITHUB_OUTPUT
    

